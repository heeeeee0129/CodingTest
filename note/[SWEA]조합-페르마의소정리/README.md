# [D3] [Professional] 조합 - 5607 

## 페르마의 소정리
> 핵심: nCr을 p로 나눈 나머지는 n!((n-r)!r!)^(p-2)을 p로 나눈 나머지와 같다

    p가 소수이면, 모든 정수 a에 대해 a^p = a (mod p)이다.
    p가 소수이고 a가 p의 배수가 아니면 a^(p-1) = 1 (mod p)이다.


### 응용 - 이항계수 nCr을 빠르게 구하기
n,r이 매우 클 경우 페르마의 소정리를 이용하여 빠르게 계산할 수 있다. 

nCr = n! / ((n-r)!*r!) 가 매우 크기 때문에 주로 어떤 소수 p에 대한 나머지를 구하는 문제가 자주 출제됨

#### 페르마의 소정리 적용
p가 소수이고 a가 p의 배수가 아니라면 

`a^(p-1) = 1 mod p` 에 따라서

`((n-r)!r!)^(p-1) = 1 mod p`가 성립 ->

`((n-r)!r!)((n-r)!r!)^(p-2) = 1 mod p` 성립


#### 모듈로 곱셈의 역원

> 어떤 수 a의 곱셈의 역원: a와 곱해서 1이 되는 수.

- mod p에 대한 곱셈의 역원

    : a* x = 1 mod p를 만족하는 x

    : a와 p가 서로소여야 한다. 
    
- a와 p가 서로소라면 양변을 a로 나눌 수 있다. 

-> <U>p가 만약 소수라면 mod p에 대한 합동식에서 p의 배수가 아닌 임의의 수로 나눌 수 있다.</U>



    ((n-r)!r!)이 p의 배수가 아니라면

    ((n-r)!r!)((n-r)!r!)^(p-2) = 1 mod p는

    ((n-r)!r!)^(p-2) = ((n-r)!r!)^(-1) mod p

    n! * ((n-r)!r!)^(p-2) = n! * ((n-r)!r!)^(-1) mod p

    우변은 nCr

    즉, nCr % p = {n!*((n-r)!r!)^(p-2)} % p


#### ((n-r)!r!)^(p-2) 거듭제곱 연산 단축시키기
-> 분할정복을 이용한 거듭제곱

    p^8 = (p^4)^2 = ((p^2)^2)^2

<aside>
지수가 짝수이면 지수를 반으로 나눠서 곱하고 홀수이면 1을 하나 뺀 뒤에 나머지 지수를 반으로 나눠서 곱하면 된다. 
</aside>

![image](https://github.com/heeeeee0129/AlgorithmStudy/assets/86648265/47299334-bed7-42ae-81f6-5f01877769fc)

시간복잡도: O(log n)

+ mod 연산

```python

def power(a, n):
    result = 1
    while n:
        if n%2 == 1:
            result *= a
        a = (a*a) % p
        n = n//2
    return result
```
